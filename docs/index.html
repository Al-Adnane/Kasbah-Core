<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Kasbah — Stop your AI from going rogue</title>
  <meta name="description" content="Runtime enforcement for AI agents — cryptographic proof before every tool execution." />
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800;900&display=swap');
    *{box-sizing:border-box;margin:0;padding:0}
    body{font-family:Inter,system-ui,sans-serif;background:#0F172A;color:#fff;line-height:1.6}
    .wrap{max-width:1100px;margin:auto;padding:40px 20px}
    h1{font-size:clamp(34px,6vw,62px);font-weight:900;margin-bottom:12px;text-align:center}
    .lead{text-align:center;font-size:20px;opacity:.78;max-width:820px;margin:0 auto 10px}
    .sublead{text-align:center;font-size:14px;opacity:.62;max-width:900px;margin:0 auto 22px}
    .cta{display:flex;gap:14px;justify-content:center;flex-wrap:wrap;margin-bottom:18px}
    .btn{padding:14px 22px;border-radius:10px;font-weight:900;cursor:pointer;border:none;background:#C1440E;color:#fff;text-decoration:none;display:inline-block}
    .btn.secondary{background:transparent;border:1px solid rgba(255,255,255,.28)}
    #demo{padding-top:18px}
    .grid{display:grid;gap:18px}
    @media(min-width:900px){.grid{grid-template-columns:1fr 1fr}}
    .card{background:rgba(255,255,255,.04);border:1px solid rgba(255,255,255,.10);border-radius:14px;padding:18px}
    .card h3{margin-bottom:6px}
    .hint{opacity:.68;font-size:13px;margin-top:2px}
    .terminal{background:#000;border-radius:10px;padding:12px;font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace;font-size:13px;white-space:pre-wrap;margin-top:10px;min-height:118px;border:1px solid rgba(255,255,255,.14)}
    details{margin-top:18px;background:rgba(255,255,255,.03);border:1px solid rgba(255,255,255,.08);border-radius:14px;padding:16px}
    summary{cursor:pointer;font-weight:900}
    .opt{margin-top:10px;opacity:.84}
    .story{margin-top:10px;padding:14px;border-radius:12px;border:1px solid rgba(255,255,255,.10);background:rgba(0,0,0,.22)}
    .row{display:grid;gap:12px}
    @media(min-width:900px){.row{grid-template-columns:1fr 1fr}}
    .box{padding:12px;border-radius:10px;background:rgba(255,255,255,.03);border:1px solid rgba(255,255,255,.08)}
    .box code{background:rgba(0,0,0,.25);padding:2px 6px;border-radius:6px;color:#ffb09a;font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace}
    ul{margin:8px 0 0 18px}
    li{margin:6px 0}
    footer{text-align:center;opacity:.6;font-size:13px;padding:50px 20px 20px}
  </style>
</head>
<body>
  <!-- LIVE_MARKER_DOCS_DEMO_V4 -->

  <div class="wrap">
    <h1>AI agents are getting dangerously smart</h1>
    <p class="lead">
      Once an agent has credentials, <b>auth alone can’t stop the wrong action</b>.<br/>
      Kasbah enforces <b>cryptographic proof before execution</b>.
    </p>
    <div class="sublead">Browser simulator. Real enforcement happens in Kasbah-Core (server-side).</div>

    <div class="cta">
      <button class="btn" onclick="document.getElementById('demo').scrollIntoView({behavior:'smooth'})">Try the demo ↓</button>
      <a class="btn secondary" href="https://github.com/Al-Adnane/Kasbah-Core" target="_blank" rel="noreferrer">GitHub</a>
      <a class="btn secondary" href="https://github.com/Al-Adnane/Kasbah-Core/issues/new/choose" target="_blank" rel="noreferrer">Feedback</a>
    </div>
  </div>

  <div id="demo" class="wrap">
    <div class="grid">
      <div class="card">
        <h3>Safe: execute once</h3>
        <div class="hint">Normal path: decide → ticket → consume → audit.</div>
        <button class="btn" onclick="runSafe()">Run safe flow</button>
        <div class="terminal" id="out1">—</div>
      </div>

      <div class="card">
        <h3>Attack: replay ticket</h3>
        <div class="hint">Mundane bug: retries/loops reuse a token by accident.</div>
        <button class="btn" onclick="runReplay()">Try replay</button>
        <div class="terminal" id="out2">—</div>
      </div>

      <div class="card">
        <h3>Attack: swap tool</h3>
        <div class="hint">Mundane bug: context drift calls the wrong function.</div>
        <button class="btn" onclick="runSwap()">Try tool swap</button>
        <div class="terminal" id="out3">—</div>
      </div>

      <div class="card">
        <h3>Full protocol</h3>
        <div class="hint">Verify + single-use + audit chain (tamper breaks chain).</div>
        <button class="btn" onclick="runFull()">Run full flow</button>
        <div class="terminal" id="out4">—</div>
      </div>
    </div>

    <details>
      <summary>Concrete before → after (the “mundane workflow” mapping)</summary>
      <div class="story">
        <div class="row">
          <div class="box">
            <b>Before Kasbah (today)</b><br/><br/>
            A support agent opens <b>Customer A</b>. User says: “refund my last invoice.”<br/>
            Then something normal happens:
            <ul>
              <li>timeout → retry,</li>
              <li>pagination loads another record,</li>
              <li>new user message mid-run.</li>
            </ul>
            Context/pointer drifts. The agent executes:<br/><br/>
            <code>billing.refund(customer_id=...)</code><br/><br/>
            …but it targets <b>Customer B</b> (similar email / stale state / name collision).<br/><br/>
            <b>Nothing was hacked.</b> Auth was valid. The runtime action was wrong.
          </div>

          <div class="box">
            <b>With Kasbah</b><br/><br/>
            The agent can’t run <code>billing.refund</code> just because it’s authenticated.<br/>
            It must present a signed execution ticket bound to:
            <ul>
              <li><b>tool</b>: <code>billing.refund</code></li>
              <li><b>target</b>: <code>customer_id = A</code></li>
              <li><b>TTL</b>: stale context expires</li>
              <li><b>single-use</b>: retries/loops can’t replay</li>
            </ul>
            When context drifts, verification fails → <code>DENY</code> before execution.<br/><br/>
            Result: the “helpful mistake” becomes a blocked action.
          </div>
        </div>

        <div class="opt">
          <b>Mapping to buttons:</b>
          <ul>
            <li><b>Replay ticket</b> ≈ retry/loop reusing “okay” auth</li>
            <li><b>Swap tool</b> ≈ wrong call after context drift</li>
            <li><b>Safe</b> ≈ decide → proof → execute once → audit</li>
          </ul>
        </div>
      </div>
    </details>

    <details>
      <summary>Mechanics (optional)</summary>
      <div class="opt">
        In production, Kasbah verifies signatures, tool binding, TTL, and “already consumed” state, then appends a hash-chained audit log.
      </div>
    </details>
  </div>

  <footer>Built in Rabat · MIT License · Demo-first page</footer>

  <script>
    let used = false;
    function out(id, t){ document.getElementById(id).textContent = t; }

    function runSafe(){
      used = false;
      out('out1',
        "DECIDE  ✅ allow\n" +
        "TICKET  ✅ issued (tool-bound, ttl=60s)\n" +
        "VERIFY  ✅ signature valid; tool match; ttl valid\n" +
        "CONSUME ✅ allowed (1/1)\n" +
        "AUDIT   ✅ appended (hash-chained)\n\n" +
        "Result: executed under proof, not trust."
      );
    }

    function runReplay(){
      if (!used){
        used = true;
        out('out2',
          "CONSUME ✅ allowed (first use)\n" +
          "CONSUME ❌ denied (second use)\n" +
          "reason=ticket_already_consumed\n\n" +
          "Maps to: retries/loops reusing a token."
        );
      } else {
        out('out2', "CONSUME ❌ denied\nreason=ticket_already_consumed");
      }
    }

    function runSwap(){
      out('out3',
        "DECIDE  ✅ allow tool=db.query\n" +
        "CONSUME ❌ denied\n" +
        "reason=tool_mismatch\n\n" +
        "Maps to: context drift calling the wrong tool."
      );
    }

    function runFull(){
      out('out4',
        "DECIDE → ALLOW\n" +
        "TICKET → SIGNED + tool-bound + ttl\n" +
        "VERIFY → OK\n" +
        "CONSUME → OK (single-use)\n" +
        "AUDIT → HASH-CHAINED\n\n" +
        "Tamper test: modify one event → chain verification fails."
      );
    }
  </script>
</body>
</html>
